# StickerShop – Telegram Sticker Store (Express + Postgres)

Sales site for Telegram sticker packs with admin and user panels. Uses Node.js (Express), EJS templates, and PostgreSQL. Admin login is seeded as username `admin` with password `123`.

## Features

- Browse sticker packs, view details, and create an order
- Orders tracked with statuses: pending, paid, delivered, cancelled
- User panel: register/login and view your orders
- Admin panel: login, CRUD sticker packs, update order statuses
- Large, modern CSS for a pretty UI

## Local Development

Requirements:
- Node.js 18+
- PostgreSQL (local or cloud, e.g. Neon)

Steps:
1. Copy `.env.example` to `.env` and set `DATABASE_URL` and `SESSION_SECRET`.
2. Install dependencies: `npm install`
3. Start the server: `npm start`
4. Open `http://localhost:3000`

On first start the DB schema is created automatically and the admin user is seeded:
- Admin username: `admin`
- Admin password: `123`

## Database Schema

Tables created on boot:
- `users(id, username, email, password_hash, is_admin, created_at)`
- `sticker_packs(id, name, description, price_cents, image_url, pack_url, created_at)`
- `orders(id, user_id, sticker_pack_id, price_cents, buyer_email, buyer_telegram, status, created_at, updated_at)`

## Deploy Free (Render)

This repo includes a `render.yaml` blueprint for one-click deploy:

1. Push this repo to GitHub.
2. In Render, create a new Blueprint and connect the repo.
3. Render creates a free Postgres instance and a free Web Service.
4. It wires `DATABASE_URL` automatically; `SESSION_SECRET` is autogenerated.
5. Deploys with `npm install` and `npm start`.

After deploy:
- Visit your service URL
- Admin: `/admin` → login `admin` / `123`

## Alternate Free Hosting

- Railway: create Postgres + Node service, set `DATABASE_URL` and `SESSION_SECRET` env vars, start command `npm start`.
- Fly.io: use a Dockerfile (optional) and a managed Postgres add-on; set env vars.
- Vercel: use a separate Postgres provider (e.g., Neon), set `DATABASE_URL`; note that session memory store isn’t persistent—recommend a session store add-on for production.

## Notes

- Do not keep the default admin password in production; change it in the DB or add a UI to update.
- Memory session store is for demo/dev; for production use a persistent store (e.g., `connect-pg-simple`).
- Payments are not integrated; orders are placed as `pending` and can be marked `paid`/`delivered` in the admin.

## Telegram Notifications

## Crypto Payments (Coinbase Commerce)

- Set in `.env`:
  - `COINBASE_COMMERCE_API_KEY` (from commerce.coinbase.com)
  - `COINBASE_COMMERCE_WEBHOOK_SECRET`
- Flow:
  - Creating an order redirects to a hosted crypto checkout.
  - Webhook `POST /webhooks/coinbase` verifies signature and marks order paid on `charge:confirmed`.
  - Order page then reveals the sticker pack link.
  - Admin can still update statuses manually.

To notify buyers on Telegram when an order is marked "paid":

- Set `TELEGRAM_BOT_TOKEN` in `.env` to your bot token (from @BotFather).
- Buyers should enter a `buyer_telegram` in the purchase form. Bots cannot DM a user until the user has started the bot at least once; numeric chat IDs or group/channel usernames work best.
- Optionally set `TELEGRAM_DEFAULT_CHAT_ID` (group/channel/user id) to receive a fallback notification if the bot cannot DM the buyer directly.
